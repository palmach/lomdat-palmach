var arrM1Words = [
    {
        "year": "1920",
        "event": "הקמת ההגנה",
        "explain": " ״ההגנה״ הוקמה על מנת לכונן הגנה כוללת ליישוב היהודי מפני התקפות ערביי הארץ."
    },
    {
        "year": "אפריל 1941",
        "event": "הקמת הפלמ״ח",
        "explain": "החלטת המפקדה הארצית של אירגון ה״הגנה״ על הקמת כוח ארצי מגויס שיקרא פלוגות המחץ. במאי 1941 הוקמו במסגרת ארגון ה״הגנה״ שש פלוגות מחץ ניידות (פלמ״ח), כעתודה קרבית ארצית ומרחבית, הנכונה לפעולה מיידית. הן מוקמו בגליל ובעמק יזרעאל המזרחיים; בגליל ובעמק יזרעאל המערביים ובאזור חיפה; בשומרון ובשרון; בתל אביב; בדרום הארץ ובירושלים. כמפקד הפלמ״ח נתמנה יצחק שדה. "
    },
    {
        "year": "מאי 1941",
        "event": "מבצע כ״ג יורדי הסירה",
        "explain": "נחשב למבצע הראשון של הפלמ״ח. אנשי הפלמ״ח סייעו לבריטים בכיבוש סוריה ולבנון מידי צרפת; סירה עם 23 לוחמי הפלמ״ח יצאה לתקוף את בתי הזיקוק בטריפולי, ולא חזרה."
    },
    {
        "year": "אוגוסט 1942",
        "event": "היפרדות מהבריטים וירידה למחתרת",
        "explain": "לאחר הניצחון הבריטי את הפולש הנאצי, לא ראו הבריטים עוד צורך בקיומו של הפלמ״ח, והפסיקו את המימון והסיוע שניתן לו. הארגון נאלץ לרדת למחתרת. בשלב זה הציע יצחק טבנקין כי הארגון יחזיק את עצמו באמצעות עבודה בקיבוצים: כל קיבוץ יקבל מחלקת פלמ״ח, יספק לה מזון, מגורים ומשאבים אחרים (כנשק), ובתמורה תעבוד המחלקה בשדות הקיבוץ ותסייע בשמירתו ובהגנה עליו. הצעה זו התקבלה באוגוסט 1942. "
    },
    {
        "year": "אוקטובר 1942",
        "event": "הקמת תנועת המרי העברי",
        "explain": "ארגון גג של המחתרות העבריות בארץ ישראל. התנועה הוקמה לאחר סיום מלחמת העולם השנייה, במטרה להביא לסיום המנדט הבריטי בארץ ישראל ולהקים מדינה יהודית תוך גיוס דעת רוב הקהל העולמית נגד בריטניה."
    },
    {
        "year": "נובמבר 1947 עד נובמבר 1948",
        "event": "הפלמ״ח במלחמת העצמאות",
        "explain": "פעולותיו של הפלמ״ח בתקופה זו היו: העברת אספקה לנגב ולגליל, שמירה על קו המים בנגב, קיום הקשר עם נקודות יישוב מנותקות וליווי שיירות האספקה לירושלים הנצורה. חטיבות הפלמ״ח השתתפו במבצעי ״נחשון״, ״יבוסי״, ״יפתח״, ״מכבי״, ״יורם״, ״מבצע ההר״, ״דני״, ״מבצע יואב״ ועוד רבים אחרים. עיקר לחימת הפלמ״ח הייתה בצפון, בנגב ובפריצת הדרך לירושלים."
    },
    {
        "year": "נובמבר 1948",
        "event": "פירוק הפלמ״ח",
        "explain": " דוד בן-גוריון קיבל את ההחלטה על פירוק המטה הנפרד של הפלמ״ח והטמעת יחידותיו בתוך צה״ל, כחלק בלתי נפרד ממנו. "
    }
];

var arrM4Words = [
    {
        "place": "ראש הנקרה",
        "explain": "ראש הנקרה הינו קיבוץ בגבול ישראל-לבנון שנוסד ב- 5 בינואר 1949 בידי שתי הכשרות פלמ״ח שלחמו במלחמת העצמאות."
    },
    {
        "place": "בית קשת",
        "explain": "בית קשת הוא ההיאחזות הראשונה שנוסדה בידי אנשי הפלמ״ח באוגוסט 1944, במחוז הצפון, בנפת כנרת. ההיאחזות הפכה בידי חלק מחבריה הראשונים לקיבוץ במסגרת ״הקיבוץ המאוחד״."
    },
    {
        "place": "משגב עם",
        "explain": "משגב עם הוא היאחזות פלמ״ח שהפכה ממוקמת באזור הגליל העליון המזרחי, בגובה 841 מ' מעל פני הים, כארבעה ק״מ ממערב לקריית-שמונה."
    },
    {
        "place": "להבות חביבה",
        "explain": "להבות חביבה הוא קיבוץ במועצה איזורית מנשה שנוסד באוקטובר 1949 על ידי הכשרת פלמ״ח שהתגייסה לגדוד 7 בחטיבת הנגב במלחמת העצמאות."
    },
    {
        "place": "פלמחים",
        "explain": "פלמחים הינו קיבוץ שנוסד באפריל 1949 בידי גרעין שהתגייס לפלמ״ח באוקטובר 1946. חברי הגרעין לקחו חלק במלחמת העצמאות בקרבות שונים בגליל במסגרת הגדוד השלישי של חטיבת יפתח והשתתפו גם במבצע דני."
    },
    {
        "place": "משמר הנגב",
        "explain": "משמר הנגב הינו קיבוץ שהוקם ב- 6 באוקטובר 1946 במסגרת מבצע עליית י״א היישובים בנגב."
    },
    {
        "place": "חצרים",
        "explain": " חצרים הוא קיבוץ שהוקם ב- 6 באוקטובר 1946 במסגרת מבצע עליית י״א הישובים בנגב.",
        "timer": "5000"
    },
    {
        "place": "נירים",
        "explain": "נירים הינו קיבוץ שנוסד בנגב המערבי ב- 6 באוקטובר 1946 במסגרת מבצע הקמת י״א הנקודות בנגב. רוב חברי הקיבוץ נמנו עם קבוצת הכשרה של הפלמ״ח.",
        "timer": "9000"
    },
    {
        "place": "צרעה",
        "explain": "צרעה הוא קיבוץ שנוסד ב- 7 בדצמבר 1948 בידי איחוד של שלוש הכשרות פלמ״ח, חברי ההכשרות לחמו במלחמת העצמאות וחלקם שוחרו מהפלמ״ח מוקדם על מנת שיוכלו להצטרף להקמת הקיבוץ."
    }
];

var arrM5Questions = [
    {
        "questionNum": "1",
        "question": "מהם ראשי התיבות של הפלמ״ח?",
        "1": "פלוגות המחץ",
        "2": "פלוגות המחצלות",
        "3": "פלוגת המילואים",
        "4": "פורצי המדינה",
        "explain": "ראשי התיבות של הפלמ״ח הם ״פלוגות המחץ״. הפלמ״ח שימש כחטיבה המגויסת של ארגון ״ההגנה״ שהיה כח המגן הצבאי של הישוב היהודי והתנועה הציונית, עד הקמת המדינה.",
        "correctAns": "1"
    },
    {
        "questionNum": "2",
        "question": "מי היה מפקד הפלמ״ח הראשון?",
        "1": "יעקוב דורי",
        "2": "יצחק שדה",
        "3": "יגאל אלון",
        "4": "יצחק רבין",
        "explain": "מפקד הפלמ״ח הראשון היה יצחק שדה. יעקב דורי היה רמטכ״ל ההגנה והרמטכ״ל הראשון של צה״ל. יגאל אלון היה מפקד הפלמ״ח השני. יצחק רבין היה מפקד חטיבת הראל במהלך מלחמת העצמאות וכיהן כרמטכ״ל השביעי של ישראל.",
        "correctAns": "2"
    },
    {
        "questionNum": "3",
        "question": "מה ידועה כפעילות הראשונה של הפלמ״ח?",
        "1": "ליל הגשרים",
        "2": "כ״ג יורדי הסירה",
        "3": "מבצע המרי העברי",
        "4": "מבצע נחשון",
        "explain": "הפעולה הראשונה של הפלמ״ח היא פעילות כ״ג יורדי הסירה שיצאה לפועל בחודש מאי 41, מספר ימים לאחר הקמת הפלמ״ח.",
        "correctAns": "2"
    },
    {
        "questionNum": "4",
        "question": "איזה פלוגה הייתה הראשונה לעבור במעלה פלמ״ח כחלק ממסעה בנגב?",
        "1": "פלוגה א",
        "2": "פלוגת הראל",
        "3": "פלוגת הנגב",
        "4": "פלוגה ג",
        "explain": "פלוגה ג יצאו בחורף 1944 למסע להכרת הנגב, במהלכו הגיעו הם טיילו בנחל חתירה, החליטו לטפס דרך המפל הישב בנחל ופילסו מעבר מעבר דרך המצוק התלול. הבדואים שפגשו אותם לאחר מכן, כינו את המעבר ״נקב אל יהוד״, וכיום הוא מוכר כ״מעלה פלמ״ח״",
        "correctAns": "4"
    },
    {
        "questionNum": "5",
        "question": "כיצד אנשי הפלמ״ח התחברו לארץ ישראל?",
        "1": "דרך טיולים ומסעות בארץ",
        "2": "התראו עם קבוצות מגוונות של אנשים",
        "3": "כתבו שירים על הארץ",
        "4": "אף תשובה לא נכונה",
        "explain": " אחד הדברים שאליהם חונכו פעילי הפלמ״ח היה למסעות, לסייר בארץ. בני מרשק אמר פעם ״בכל צבא בעולם תפקידו של הסייר לגלות את האויב, בפלמ״ח- תפקידו לגלות את המולדת.",
        "correctAns": "1"
    },
    {
        "questionNum": "6",
        "question": " ״מִמְּטוּלָה עַד____,מִן הַיָּם עַד הַמִּדְבָּר״- מהי המילה החסרה בהמנון הפלמ״ח?",
        "1": "אילת",
        "2": "הדרום",
        "3": "החרמון",
        "4": "הנגב",
        "explain": "המילה החסרה היא ״הנגב״. השיר מדבר על אהבת ארץ ישראל מכל עבריה- במזרח: מדבר, במערב: הים התיכון, בצפון: מטולה ובדרום: הנגב.",
        "correctAns": "4"
    },
    {
        "questionNum": "7",
        "question": "מהו סמל הפלמ״ח?",
        "1": "לוחם פלמ״ח עם עט חפירה",
        "2": "שלושה עלי זית ונעלי חלוצים",
        "3": " מגן דוד עם קקטוסים",
        "4": "שני גבעולי חיטה ושעורה בשילוב עם חרב",
        "explain": "סמל הפלמ״ח: שני גבעולי חיטה ושעורה בשילוב עם חרב. הסמל ביטא את השילוב שבין עבודה חקלאית לבין כוח צבאי.",
        "correctAns": "4"
    }
];

var arrExplainMishText = [
    {
        "explain": "media/mish1/explain-mish1-text.png"
    },
    {
        "explain": "media/mish2/mish2-explain.png",
        "back": "media/mish2/back-mish2.png"
    },
    {
        "explain": "media/mish3/mish3-explain.png",
        "back": "media/mish3/back-mish3-text.png"
    },
    {
        "explain": "media/mish4/explain-mish4.png",
        "back": "media/mish4/back-mish4-text.png"
    },
    {
        "explain": "media/mish5/explain-mish5.png",
    }
];

var arrboyTalk = [];
var arrgirlTalk = [];

var arrRndEventList = ["", "", "", "", "", "", ""];
var nMission1Click = 0;
var nMissionClickSum = 0;
var arrMission1Ans = [];
var strChosenGen;

var nMin;
var strSec;
var nSec;

var nTimer;

var nMishNum = 0;
var bStrtMish = false;

var MIN_SCORE = 460;
var nSumScore = MIN_SCORE;
// #1   #2  #3  #4 #5
var arrScoreBord = [10, 10, 5, 10, 10];
var arrMinScoreBord = [130, 80, 150, 100, 20];
var nCurrNewScore = 0;
var nMis3Score = 0;

var strFinishMisText;
var nCurrScore;

var ANSWER_TO_RIDL = ["מ", "ה", "א", "ה", "ב", "ה", "ל", "א", "ד", "מ", "ת", "א", "ר", "ץ", "י", "ש", "ר", "א", "ל"];
var arrM3WordLength = [6, 5, 3, 5];

var bIsInptgood;

var nCurrentQuestion = 0;

var strMovedPeregraf;
var nIsPosition = 0;

var bTimePause = true;
var bTimeEnd = true;

$(function () {
    startPage();
});

var arrBeforeText = [
    {
        "headline": "media/back-headline1.png",
        "text": "<p class='before-p'>ארגון הפלמ״ח (פלוגות המחץ), הוקם בל״ג בעומר התש״א ה-15 במאי 1941 והיה הכוח המגויס של ה״הגנה״ והיישוב היהודי בארץ ישראל עד הקמת צה״ל בשנת 1948. רוח הפלמ״ח ודמותם של מפקדיו ולוחמיו היו למעצבי התפיסה הערכית, המקצועית והתרבותית של הצבא הישראלי.<br><span id='bold-explain'> אהבת המולדת באה לידי ביטוי בעשייה של לוחמי הפלמ״ח:</span> הם הובילו מסעות במטרה להכיר את הארץ, שביליה ונופיה, הקימו נקודות היאחזות חקלאיות באזורים בלתי מיושבים על ידי יהודים, עבדו והתאמנו בקיבוצים ופעלו במטרה להגן על הארץ ועל תושביה היהודיים.</p>",
        "button": "להוראות"
    },
    {
        "headline": "media/back-headline2.png",
        "text": "<p class='before-p before-instructions'>בפעילות הקרובה אתם הולכים לעבור מספר משימות.<br>בכל משימה יהיה שעון שאומר תוך כמה זמן תתבקשו לסיים את המשימה, סיום לפני הזמן יזכה אתכם בנקודות נוספות.<br>אל חשש- בזמן שההסבר מוצג הזמן ייעצר ויימשך בסיומו.</p>",
        "button": "בואו נתחיל"
    },
    {
        "headline": "media/map-headline.png"
    },
    {
        "headline": "media/mish1/mis1-headline.png"
    },
    {
        "headline": "media/mish2/mis2-headline.png"
    },
    {
        "headline": "media/mish3/mish3-headline.png"
    },
    {
        "headline": "media/mish4/headline-mish4.png"
    },
    {
        "headline": "media/mish5/headline-mish5.png"
    },
];

function startPage() {
    $("#opening").css("display", "flex");
    $(".start-btn").on("click", explainMission);
}
var pageCounter = 0; // סופר איזה עמוד אתה נמצא
function explainMission() {
    //העמודים ההתחלתיים
    $("#opening").hide();
    $("#before-part").css("display", "flex");
    $("#headline-before").css("background-image", "url(" + arrBeforeText[pageCounter].headline + ")");
    $("#text-before").append(arrBeforeText[pageCounter].text);
    $(".before-btn-text").html(arrBeforeText[pageCounter].button)
    $(".button-before").on("click", function () {
        if (pageCounter === 0) {
            pageCounter++;
            $("#text-before").html("");
            $(".good-luck-text").show();
            explainMission();
        } else {
            choicePart();
        }
    });
}

function choicePart() {
    $("#before-part").hide();
    $("#choice-part").show();
    $("#gen-container").on("click", genChoice);
}

function genChoice(event) {
    if (strChosenGen === undefined) {
        $(".button-choice").on("click", showBigMap);
    }
    $(".character").css({ propertyName: 'background-image' });
    $(".character").show();
    strChosenGen = event.target.id.slice(0, -4);
    $(".character").css("background-image", "url(media/" + strChosenGen + "-small.png)");
}

function calcScore() {
    var nCurrSec = (nMin * 60) + nSec;
    nCurrNewScore = Math.floor(nCurrSec / 10) * Number(arrScoreBord[nMishNum]);
    nSumScore += nCurrNewScore;
    if (nMishNum === 4) {
        nMis3Score += nCurrNewScore;
    }
}

function showScore() {
    calcScore();
    $(".finish-text").html("");

    gsap.to("#finish-mish", { duration: 0.75,delay:0.25, display: "flex",ease: "sine" });

    if (nMishNum !== 4) {
        nCurrScore = nCurrNewScore + arrMinScoreBord[nMishNum];
        $(".mis-finish-btn").on("click", eval("mission" + (nMishNum + 2)));
    } else {
        nCurrScore = nMis3Score + (arrMinScoreBord[nMishNum] * 7);
        // $(".finish-text").append(strFinishMisText);
    }
    strFinishMisText = "<p>כל הכבוד</p><p>סיימתם את המשימה</p><p>עם " + nCurrScore + " נקודות!</p>";
    $(".finish-text").append(strFinishMisText);
}

function showBigMap(event) {
    pageCounter++;
    $("#choice-part").hide();
    $("#map-part").show();
    setTimeout(function () {
        $(".character").animate({
            "left": "12vw",
            "bottom": "2.5vh"
        }, 1500);
    }, 600);
    setTimeout(function () {
        $(".character").animate({
            "left": "12vw",
            "bottom": "2.5vh"
        }, 1500);
    }, 600);
    setTimeout(function () {
        $("#map").show(1300);
        setTimeout(function () {
            $("#step1").show(100);
            $("#bubble").css("background-image", "url(media/" + strChosenGen + "-order.png)");
            $("#bubble").show(100);
        }, 1000);
    }, 2200);
    $("body").css("background-image", "url(media/background.png)");
    $("#headline-map").css("background-image", "url(" + arrBeforeText[pageCounter].headline + ")");
    $("#step1").on("click", mission1);
}

function showExplainMish() {
    $("#explain-mission").css("display", "flex");

    if (arrExplainMishText[nMishNum].back !== undefined) {
        $("#text-explain").css("background-image", "url(" + arrExplainMishText[nMishNum].back + ")");
        $("#exit-btn").hide();
        $("#exit-btn").off("click")
        $("#arrow-btn").show();
        $("#arrow-btn").on("click", function () {
            $("#arrow-btn").hide();
            $("#text-explain").css({
                "background-image": "url(" + arrExplainMishText[nMishNum].explain + ")",
            });
            switch (nMishNum) {
                case (1): {
                    $("#text-explain").css({ "height": "32vh" });
                    break;
                }
                case (2): {
                    $("#text-explain").css({ "height": "30vh" });
                    break;
                }
                case (3): {
                    $("#text-explain").css({ "height": "33vh" });
                    break;
                }
                default: {
                    break;
                }
            }
            $("#exit-btn").show();
            $("#exit-btn").on("click", function () {
                bStrtMish = true;
                $("#explain-mission").hide();
                switch (nMishNum) {
                    case (1): {
                        document.getElementById("audio").autoplay = true;
                        document.getElementById("audio").load();
                        break;
                    }
                    case (2): {
                        $("#info-btn").on("mouseover", function () {
                            $("#dictionery").show();
                        });
                        $("#info-btn").on("mouseout", function () {
                            $("#dictionery").hide();
                        });
                        break;
                    }
                    case (3): {
                        $(".place-map-drag").on("mouseover", function () {
                            $("#text-discrip4").html(arrM4Words[this.id.charAt(8) - 1].explain);
                            $("#text-discrip4").show();
                        });
                        $(".place-map-drag").on("mouseout", function () {
                            $("#text-discrip4").hide();
                        });
                        break;
                    }
                    default: {
                        break;
                    }
                }
                bTimePause = true;
                bTimeEnd = true;
                $("#map-btn").on("mouseover", function () {
                    $("#small-map").show();
                });
                $("#map-btn").on("mouseout", function () {
                    $("#small-map").hide();
                });
            });
        });
    } else {
        // אם מתחיל בהוראות ולא ברקע

        $("#text-explain").css("background-image", "url(" + arrExplainMishText[nMishNum].explain + ")");
        if (nMishNum === 4) {
            $("#text-explain").css({
                "height": "23vh",
                "top": "9vh"
            });
        }
        $("#arrow-btn").hide();
        $("#exit-btn").show();
        $("#exit-btn").on("click", function () {
            bStrtMish = true;
            $("#explain-mission").hide();
            if (nMishNum === 0) {
                nTimer = setInterval(timer, 1000);
            } else {
                bTimePause = true;
                bTimeEnd = true;
            }
            $("#map-btn").on("mouseover", function () {
                $("#small-map").show();
            });
            $("#map-btn").on("mouseout", function () {
                $("#small-map").hide();
            });
        });
    }
}

function createList() {
    // יוצא רשימה רנדומלית
    var bExist = false;
    var nRndNum;
    nRndNum = Math.floor(Math.random() * arrRndEventList.length);
    arrRndEventList[0] = nRndNum;
    for (var n = 1; n < arrRndEventList.length; n++) {
        nRndNum = Math.floor(Math.random() * arrRndEventList.length);
        while (!bExist) {
            for (var i = 0; i < n && bExist === false; i++) {
                if (arrRndEventList[i] === nRndNum) {
                    bExist = true;
                }
            }
            if (bExist) {
                nRndNum = Math.floor(Math.random() * arrRndEventList.length);
                bExist = false;
            } else {
                bExist = true;
            }
        }
        arrRndEventList[n] = nRndNum;
        bExist = false;
    }
}

function createSmallMap() {
    for (var i = 1; i < 6; i++) {
        if (i === (nMishNum + 1)) {
            $("#small" + i).css("background-image", "url(media/small-map/" + i + "-hover.png)");
        } else {
            $("#small" + i).css("background-image", "url(media/small-map/" + i + "-btn.png)");
        }
    }
}

function mission1() {
    $("#map-part").hide();
    $("#map").hide();
    pageCounter++;

    nMin = 1;
    nSec = 59;
    bTimeEnd = true;
    strSec = "00";
    $("#timer").text("2 : 00");
    $("#mission1").show();
    $("#events-part").css("display", "flex");
    $("#events-ans-part").css("display", "flex");
    $("#years-part").css("display", "flex");

    createSmallMap();

    $("#headline-mis").css("background-image", "url(" + arrBeforeText[pageCounter].headline + ")");
    $("#general-icons").show();
    createList();
    for (var i = 0; i < arrM1Words.length; i++) {
        // יצירה של התאריכים והמילים אחד מתחת לשני
        $("#events-part").append('<div id="event' + arrRndEventList[i] + '" class="events dont-select-text text">' + arrM1Words[arrRndEventList[i]].event + '</div>');
        $("#events-ans-part").append('<div id="event-ans' + i + '" class="events-ans events dont-select-text text ">' + arrM1Words[i].event + '</div>');
        $("#years-part").append('<div id="year' + i + '" class="years text dont-select-text button">' + arrM1Words[i].year + '</div>');
    }
    showExplainMish();
    chooseAns();
}

function chooseAns() {
    // עושה שיהיה חייב קודם לבחור בעליון ואז בחתון
    if (nMission1Click === 0) {
        $("#events-part").off("click");
        $("#years-part").on("click", selectAnsMission1);
    }
    else {
        $("#events-part").on("click", selectAnsMission1);
        $("#years-part").off("click");
    }
}

// משימה ראשונה- מחבר בין שנה לאירוע
function selectAnsMission1(event) {
    if (($("#" + event.target.id).attr("class") === "events text done-ans" || $("#" + event.target.id).attr("class") === "years text done-ans") || ((arrMission1Ans[0] === event.target.id)) || (event.target === event.currentTarget)) {
        // 
    } else {
        nMission1Click++;
        arrMission1Ans.push(event.target.id);
        if (nMission1Click === 2) {
            var nNumOfCard = arrMission1Ans[0].charAt(arrMission1Ans[0].length - 1);

            // מוריד את הצבע של הבחירה
            $("#" + arrMission1Ans[0]).removeClass("selected-ans");

            // בודק לפי האי-די אם התשובה הראשונה מתאימה לשאלה השניה 
            if ((nNumOfCard === arrMission1Ans[1].charAt(arrMission1Ans[1].length - 1)) && (arrMission1Ans[0].charAt(1) !== arrMission1Ans[1].charAt(1))) {
                nMissionClickSum++;

                //  מוסיף את הצבעשל תשובה נכונה
                $("#" + arrMission1Ans[0]).addClass("correct-ans");
                $("#" + arrMission1Ans[1]).addClass("correct-ans");
                bTimePause = false;
                setTimeout(function () {
                    $("#explain-ans").css("display", "flex");
                    $("#white-back").css("display", "flex");
                    $("#events-part").off("click");
                    $("#years-part").off("click");
                    $("#text-discrip").html(arrM1Words[nNumOfCard].explain);
                    $(".events").removeClass("button");
                    $(".years").removeClass("button");

                    $("#exit-explain").on("click", function () {
                        $("#exit-explain").off("click");
                        $("#explain-ans").hide();
                        $("#white-back").hide();
                        bTimePause = true;
                        $("#" + arrMission1Ans[0]).removeClass("correct-ans");
                        $("#" + arrMission1Ans[1]).removeClass("correct-ans");
                        $("#" + arrMission1Ans[0]).addClass("done-ans");
                        $(".events").addClass("button");
                        $(".years").addClass("button");
                        $("#" + arrMission1Ans[1]).hide(1000);
                        $("#event-ans" + nNumOfCard).animate({
                            opacity: 1
                        }, 1000);
                        arrMission1Ans = [];
                        chooseAns();
                        if (nMissionClickSum === 7) {
                            bTimeEnd = false;
                            $("#map-btn").off("mouseover");
                            $("#map-btn").off("mouseout");
                            $(".character").css({
                                "left": "1vw",
                                "bottom": "-0.5vh"
                            });
                            setTimeout(function () {
                                showScore();
                            }, 1000);
                        }
                    });
                }, 1000);
            } else {
                $("#" + arrMission1Ans[0]).addClass("wrong-ans");
                $("#" + arrMission1Ans[1]).addClass("wrong-ans");
                setTimeout(function () {
                    $("#" + arrMission1Ans[0]).removeClass("wrong-ans");
                    $("#" + arrMission1Ans[1]).removeClass("wrong-ans");
                    arrMission1Ans = [];
                    chooseAns();
                }, 1000);
            }
            nMission1Click = 0;
        } else {
            $(event.target).addClass("selected-ans");
            chooseAns();
        }
    }
}


function mission2() {
    $("#text-explain").css("height", "30vh");
    nMishNum++;
    nMissionClickSum = 0;
    $("#mission1").hide();
    $("#mission2").show();
    $("#finish-mish").hide();
    $(".mis-finish-btn").off("click");
    $("#audio").show();
    nMin = 1;
    nSec = 59;
    strSec = "00";
    $("#timer").text("2 : 00");
    pageCounter++;
    $("#headline-mis").css("background-image", "url(" + arrBeforeText[pageCounter].headline + ")");
    $("#headline-mis").css("width", "31vw")
    createSmallMap();
    showExplainMish();
    $(".drag-song").draggable({
        start: function (event, ui) {
            strMovedPeregraf = this.id;
            $("#" + strMovedPeregraf).draggable({ revert: "invalid" });
        }
    });
    $(".land-song").droppable({
        classes: {
            "ui-droppable-active": "ui-state-active",
            "ui-droppable-hover": "ui-state-hover"
        },
        drop: function (event, ui) {
            $("#" + strMovedPeregraf).draggable({ revert: "false" });
            // שאם נניח במקום הנכון הוא לא יובל לזוז ואם הוא טועה שיחזור למקום    
            if (this.id.charAt(11) === strMovedPeregraf.charAt(8)) {
                $(this).append(ui.draggable.css('position', 'static')); // שלא יזוז אחרי שיניחו אותו
                nMissionClickSum++;
            } else {
                $("#" + strMovedPeregraf).draggable({ revert: "valid" });
            }
            if (nMissionClickSum === 4) {
                bTimeEnd = false;
                document.getElementById("audio").autoplay = false;
                document.getElementById("audio").load();
                $("#map-btn").off("mouseover");
                $("#map-btn").off("mouseout");
                setTimeout(function () {
                    showScore();
                }, 1000);
            }
        }
    });
}

function mission3(event) {

    $("#text-explain").css("height", "37vh");
    pageCounter++; // עבור הכותרת
    nMishNum++; // עבור ההבסבר

    nMin = 5;
    nSec = 59;
    strSec = "00";
    $("#timer").text("6 : 00");
    $("#mission2").hide();
    $("#mission3").show();
    $("#finish-mish").hide();
    $("#headline-mis").css("background-image", "url(" + arrBeforeText[pageCounter].headline + ")");
    $("#headline-mis").css({
        "width": "56vw",
        "left": "22.5vw"
    });
    $("#input-part").css("display", "flex");
    createSmallMap();

    // create the word space
    for (var i = 1; i <= arrM3WordLength.length; i++) {
        for (var a = 0; a < arrM3WordLength[i - 1]; a++) {
            $("#word" + i).append('<input type="text" autocomplete="off" id="w' + i + 'l' + a + '" class="letters">');
        }
    }

    showExplainMish();
    $(".cheack-btn").on("click", checkAnswer3);
}

function checkAnswer3(event) {
    var place = 0;
    bIsInptgood = true;
    for (var i = 1; i <= arrM3WordLength.length; i++) {
        for (var a = 0; a < arrM3WordLength[i - 1]; a++) {
            $('#w' + i + 'l' + a).removeClass("wrong-input");
            $('#w' + i + 'l' + a).removeClass("corect-input");
        }
    }

    for (var i = 1; i <= arrM3WordLength.length; i++) {
        for (var a = 0; a < arrM3WordLength[i - 1]; a++) {
            if ($('#w' + i + 'l' + a).val() === ANSWER_TO_RIDL[place]) {
                $('#w' + i + 'l' + a).addClass("corect-input");
            } else {
                $('#w' + i + 'l' + a).addClass("wrong-input");
                bIsInptgood = false
            }
            place++;
        }
    }

    if (bIsInptgood) {
        $("#map-btn").off("mouseover");
        $("#map-btn").off("mouseout");
        bTimeEnd = false;
        $("#timer-message").hide();
        setTimeout(function () {
            showScore();
        }, 1000);
    }
}

function mission4() {
    $("#mission3").hide();
    $(".mis-finish-btn").off("click");
    $("#mission4").show();
    $("#finish-mish").hide();
    $("#info-btn").hide();

    nMishNum = 3;// עבור ההבסבר
    pageCounter = 6;// עבור הכותרת
    nMin = 2;
    nSec = 29;
    strSec = "30";
    $("#timer").text("2 : 30");
    createSmallMap();
    nMissionClickSum = 0;
    $("#headline-mis").css("background-image", "url(" + arrBeforeText[pageCounter].headline + ")");
    $("#headline-mis").css({
        "height": "17vh",
        "top": "8vh",
        "left": "43.5vw",
        "width": "38vw"
    });
    $("#places-drag").css("display", "flex");
    arrRndEventList = ["", "", "", "", "", "", "", "", ""];
    createList();
    for (var i = 0; i < arrM4Words.length; i++) {
        $("#places-drag").append('<div id="drag-map' + (arrRndEventList[i] + 1) + '" class="place-map-drag ui-widget-content text button">' + arrM4Words[arrRndEventList[i]].place + '</div>');
    }

    showExplainMish();

    $(".place-map-drag").draggable({
        start: function (event, ui) {
            strMovedPeregraf = this.id;
            $("#" + strMovedPeregraf).draggable({ revert: "invalid" });
        }
    });
    $(".land-map").droppable({
        classes: {
            "ui-droppable-active": "ui-state-active",
            "ui-droppable-hover": "ui-state-hover"
        },
        drop: function (event, ui) {
            $("#" + strMovedPeregraf).draggable({ revert: "false" });
            // שאם נניח במקום הנכון הוא לא יובל לזוז ואם הוא טועה שיחזור למקום    
            if (this.id.charAt(11) === strMovedPeregraf.charAt(8)) {
                $("#" + strMovedPeregraf).addClass("placed-on-map");
                $(this).append(ui.draggable.css('position', 'static')); // שלא יזוז אחרי שיניחו אותו
                setTimeout(function () {
                    if (nMissionClickSum === 9) {
                        $("#map-btn").off("mouseover");
                        $("#map-btn").off("mouseout");
                        bTimePause = false;
                        $("#timer-message").hide();
                        setTimeout(function () {
                            showScore();
                        }, 1000);
                    }
                }, 1000);
                nMissionClickSum++;
            } else {
                $("#" + strMovedPeregraf).draggable({ revert: "valid" })
            }
        }
    });
}

function mission5() {
    $(".mis-finish-btn").off("click");
    $("#mission4").hide();
    $("#mission5").show();
    $("#finish-mish").hide();
    $("#info-btn").hide();
    pageCounter++; // עבור הכותרת
    nMishNum++; // עבור ההבסבר
    nMin = 0;
    nSec = 29;
    strSec = "30";
    $("#timer").text("0 : 30");
    $("#headline-mis").css("background-image", "url(" + arrBeforeText[pageCounter].headline + ")");
    $("#headline-mis").css({
        "width": "57vw",
        "left": "21.5vw",
        "height": "14vh",
        "top": "7vh"
    });
    createSmallMap();
    $("#question-num").html("" + (nCurrentQuestion + 1) + " / " + arrM5Questions.length);
    $("#question").text(arrM5Questions[nCurrentQuestion].question);
    for (var i = 1; i < 5; i++) {
        $("#answer" + i).text(arrM5Questions[nCurrentQuestion][String(i)]);
    }

    showExplainMish();
    $(".ans").on("click", checkAnswer5);
}

function changeInfo() {
    restartTimer();
    $("#question-num").html("" + (nCurrentQuestion + 1) + " / " + arrM5Questions.length);
    $("#question").text(arrM5Questions[nCurrentQuestion].question);
    for (var i = 1; i < 5; i++) {
        $("#answer" + i).text(arrM5Questions[nCurrentQuestion][String(i)]);
    }
    $(".ans").on("click", checkAnswer5);
}

function checkAnswer5(event) {
    $(".ans").off("click");

    bTimePause = false;
    // if the text of the chosen button equal click the answer
    if ($(event.target).attr("id").charAt(6) !== arrM5Questions[nCurrentQuestion].correctAns) {
        $(event.target).addClass("bad-option");
        setTimeout(function () {
            $("#answer" + arrM5Questions[nCurrentQuestion].correctAns).addClass("good-option");

        }, 350);
    }
    else {
        $(event.target).addClass("good-option");
        nSumScore += 20;
        calcScore();
    }

    setTimeout(function () {
        $("#explain-ans").css("display", "flex");
        $("#exit-explain").off("click");
        $("#white-back").show();
        $("#text-discrip").html(arrM5Questions[nCurrentQuestion].explain);
        $("#exit-explain").on("click", function () {
            $("#explain-ans").hide();
            $("#white-back").hide();
            nCurrentQuestion++;
            if (nCurrentQuestion > arrM5Questions.length - 1) {
                setTimeout(function () {
                    bTimeEnd = false;
                    setTimeout(function () {
                        showScore();
                    }, 1000);
                    $(".mis-finish-btn").on("click", startEnd);
                }, 1000);
            }
            else {
                nMin = 0;
                nSec = 30;
                strSec = "30";  
                bTimePause = true;
                $(event.target).removeClass("bad-option");
                $("#answer" + arrM5Questions[nCurrentQuestion - 1].correctAns).removeClass("good-option");
                changeInfo();
            }
        });
    }, 1500);
}

function restartTimer() {
    bTimeEnd = true;
    bTimePause = true;
}

var strEndText;
function startEnd(event) {
    clearInterval(nTimer);
    $("#mission5").hide();
    $("#general-icons").hide();
    $("#finish-mish").hide();
    $("#timer-message").hide();
    $("#end-part").show();
    $(".character").css({
        "width": "24vw",
        "height": "54vh",
        "left": "13vw",
        "bottom": "10.5vh"
    });

    $(".to-end-btn").on("click", function () {
        $("#end-part").hide();
        strEndText="<p>סיימתם את</p><p>הלומדה בהצלחה</p><p>עם " + nSumScore + " נקודות!</p>"
        $(".end-score-text").append(strEndText);
        $("#end-points-part").show();
        $(".about-btn").on("click", function () {
            $("#end-points-part").hide();
            $("#about-page").show();
        });
    });
}

function timer() {
    if(pageCounter===7){
    }
    if (bTimeEnd && bTimePause) {
        if (nSec < 10) {
            strSec = "0" + nSec;
        } else {
            strSec = nSec;
        }
        $("#timer").text("" + nMin + " : " + strSec);
        if (nMin === 0 && nSec === 0) {
            bTimeEnd = false;
            clearInterval(nTimer);
            gsap.to("#timer-message", { duration: 0.75, delay:0.25, ease: "sine", display: "flex" });
            $(".character").css({
                "left": "1vw"
            });
            $(".continue-btn").on("click", function () {
                $("#timer-message").hide();

            });
        } else {
            if (nMin !== 0 && nSec === 0) {
                nMin--;
                nSec = 60;
            }
            nSec--;
        }
    }
}
